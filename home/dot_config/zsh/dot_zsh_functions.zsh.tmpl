# vim: syntax=sh

function brew_bundle() {
  echo "Run brew bundle..."
  brew bundle --no-lock --file={{ .brew.brewfilePath }}
}

function brew_update {
  brew update &&
  brew upgrade &&
  brew cleanup
}

function zinit_update {
  zi self-update &&
  zi update --all &&
  zi delete --clean
}

function update_all {
  brew_update &&
  zinit_update &&
  GH_TOKEN=$OCTO_TOKEN gh extension upgrade --all &&
  asdf reshim
}

function miszo_git_local_config {
    git config --local user.name {{ .name | quote }}
    git config --local user.email {{ .git.personal.email | quote }}
    echo "Local git user email changed to personal"
    git config --local --get user.name
    git config --local --get user.email
}

function git_clear_gone_branches {
    git remote prune origin
    git branch -vv | grep ': gone]'|  grep -v "\*" | awk '{ print $1; }' | xargs -I{} -n 1 git branch -D {}
    git prune
}

function copy_branch {
    git rev-parse --abbrev-ref HEAD | pbcopy
    echo Copied branch name: \`$(pbpaste)\`
}

function remove_docker_containers {
    echo "Stop running docker containers"
    docker stop $(docker ps -q)
    echo "Remove docker containers"
    docker rm $(docker ps -a -q)
}

function remove_docker_images {
    remove_docker_containers
    echo "Remove docker images"
    docker rmi $(docker images -f "dangling=true" -q)
}

function clean_docker {
    remove_docker_images
    echo "Remove docker volumes"
    docker volume rm $(docker volume ls -qf dangling=true)
    echo "Docker cleanup done!"
}


function git_pull_them_all {
    for D in *; do
        if [ -d "${D}/.git" ]; then
            echo "Running git pull and clean branches in ${D}" && cd "${D}" && git pull && git_clear_gone_branches && cd .. && echo "Done!\n"
        fi
    done
}

function export_velja_settings() {
  echo "Exporting Velja settings..."
  defaults export com.sindresorhus.Velja {{ .velja.veljaFilePath }}
  echo "Velja settings exported!"
}

function import_velja_settings() {
  echo "Importing Velja settings..."
  defaults import com.sindresorhus.Velja {{ .velja.veljaFilePath }}
  echo "Velja settings imported!"
}

function delete_recursively {
    readonly folder_name=${1:?"node_modules"}
    find . -name "$folder_name" -type d -prune -print -exec rm -rf '{}' \;
}
